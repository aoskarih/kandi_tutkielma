% STEP 1: Choose oneside or twoside
\documentclass[finnish,twoside,openright]{HYgradu}

%\usepackage[utf8]{inputenc} % For UTF8 support. Use UTF8 when saving your file.
\usepackage{lmodern} % Font package
\usepackage{textcomp} % Package for special symbols
\usepackage[pdftex]{color, graphicx} % For pdf output and jpg/png graphics
\usepackage[pdftex, plainpages=false]{hyperref} % For hyperlinks and pdf metadata
\usepackage{fancyhdr} % For nicer page headers
\usepackage{tikz} % For making vector graphics (hard to learn but powerful)
%\usepackage{wrapfig} % For nice text-wrapping figures (use at own discretion)
\usepackage{amsmath, amssymb} % For better math
\usepackage[square]{natbib} % For bibliography
\usepackage[footnotesize,bf]{caption} % For more control over figure captions
\usepackage{blindtext}
\usepackage{titlesec}
\usepackage[titletoc]{appendix}
\usepackage[symbol]{footmisc}
\usepackage{float}


\onehalfspacing %line spacing
%\singlespacing
%\doublespacing

%\fussy 
\sloppy % sloppy and fussy commands can be used to avoid overlong text lines
\renewcommand{\thefootnote}{\fnsymbol{footnote}}


% STEP 2:
% Set up all the information for the title page and the abstract form.
% Replace parameters with your information.
\title{Symplektiset integrointimenetelmät}
\author{Arttu Hyvönen}
\date{\today}
%\level{Bachelor's thesis}
\level{Kandidaatintutkielma}
\subject{Teoreettinen fysiikka}
%\subject{Your Field}
\faculty{Matemaattis-luonnontieteellinen tiedekunta}
%\faculty{Faculty of Whatever}
\programme{Fysikaalisten tieteiden kandiohjelma}
\department{Fysiikan laitos}
%\department{Department of Something}
\address{PL 64 (Gustaf Hällströmin katu 2a)\\00014 Helsingin yliopisto}
\prof{Pauli Pihajoki}
\censors{arvostelija Testi}{arvostelija Arvostelija}{}
\keywords{}
\depositeplace{}
\additionalinformation{}
\classification{}

% if you want to quote someone special. You can comment this line and there will be nothing on the document.
%\quoting{Bachelor's degrees make pretty good placemats if you get them laminated.}{Jeph Jacques} 


% OPTIONAL STEP: Set up properties and metadata for the pdf file that pdfLaTeX makes.
% But you don't really need to do this unless you want to.
\hypersetup{
    bookmarks=true,         % show bookmarks bar first?
    unicode=true,           % to show non-Latin characters in Acrobatâ€™s bookmarks
    pdftoolbar=true,        % show Acrobatâ€™s toolbar?
    pdfmenubar=true,        % show Acrobatâ€™s menu?
    pdffitwindow=false,     % window fit to page when opened
    pdfstartview={FitH},    % fits the width of the page to the window
    pdftitle={},            % title
    pdfauthor={},           % author
    pdfsubject={},          % subject of the document
    pdfcreator={},          % creator of the document
    pdfproducer={pdfLaTeX}, % producer of the document
    pdfkeywords={something} {something else}, % list of keywords for
    pdfnewwindow=true,      % links in new window
    colorlinks=true,        % false: boxed links; true: colored links
    linkcolor=black,        % color of internal links
    citecolor=black,        % color of links to bibliography
    filecolor=magenta,      % color of file links
    urlcolor=cyan           % color of external links
}

\begin{document}

% Generate title page.
\maketitle

% STEP 3:
% Write your abstract (of course you really do this last).
% You can make several abstract pages (if you want it in different languages),
% but you should also then redefine some of the above parameters in the proper
% language as well, in between the abstract definitions.

\begin{abstract}
Kirjoita tiivistelmään lyhyt, enintään 250 sanan yhteenveto työstäsi: mitä olet tutkinut, millaisia menetelmiä olet käyttänyt, millaisia tuloksia sait ja millaisia johtopäätöksiä niiden perusteella voi tehdä.
\end{abstract}

% Place ToC
\mytableofcontents

\mynomenclature

% -----------------------------------------------------------------------------------
% STEP 4: Write the thesis.
% Your actual text starts here. You shouldn't mess with the code above the line except
% to change the parameters. Removing the abstract and ToC commands will mess up stuff.
\chapter{Johdanto}

rakenne

* taustaa: numeerisia menetelmiä

* mitä työllä haetaan: Symplektisyys = cool

* mitä ihmettä: selitetään hamilton + symplektisyys

* miten näytetään: Verrataan 2 menetelmää, symp. ja ei symp.



\chapter{Liikeyhtälöt}
Jos halutaan ratkaista fysikaalisen systeemin kehitys, ensin tarvitaan yhtälöt kuvaavaamaan tätä kehitystä. Monesti järkevin tapa systeemin liikeyhtälöiden selvittämiseen on käyttää Hamiltonin mekaniikka. 

Hamiltonin mekaniikka voidaan johtaa Lagrangen mekaniikasta, joka puolestaan uudelleen muotoili Newtonin mekaniikan variaatiolaskennan avulla. Muista tavoista poiketen Hamiltonin mekaniikalla liikeyhtälöiksi saadaan ensimmäisen asteen differentiaaliyhtälöitä, joka tekee numeerisesta laskennasta suoraviivaisempaa.

%Mistä saadaan differentiaaliyhtälöt joita yritetään ratkaista?

\section{Lagrangen mekaniikka}
Fysikaaliset systeemit useimmiten kehittyvät ajassa seuraten pienimmän vaikutuksen periaatetta\footnote{engl. Principle of least action}. Eli toisin sanoen systeemin, jolla on $N$ vapausastetta, kehitys saadaan funktionaalin
\begin{align} \label{eq:funktionaali}
S[\mathbf{q}(t)] = \int_{t_0}^{t_1} L(\mathbf{q}(t), \mathbf{\dot{q}}(t), t) \: dt
\end{align}
% Tarviiko selittää auki \dot{q} = aikaderivaatta?
ääriarvona. Missä Lagrangen funktio $L$ on kineettisen- ja potentiaalienergian erotus, $\mathbf{q}$ on yleistetty $N$ ulotteinen koordinaattivektori ja $\mathbf{\dot{q}}$ vastaava nopeus. Koordinaattivektoreiden komponentteja tullaan merkitsemään alaindeksillä $i$.  

Funktionaalista \ref{eq:funktionaali} voidaan edelleen johtaa Eulerin-Lagrangen yhtälöt
\begin{align} \label{eq:eulerlag}
\frac{d}{dt}\left(\frac{\partial L}{\partial \dot{q}_i}\right) - \frac{\partial L}{\partial q_i} = 0
\end{align}
joista saadaan $N$ toisen asteen differentiaaliyhtälöä systeemin kehitykselle. \citep{arnold_1989}

\section{Hamiltonin mekaniikka}
Lagrangen mekaniikan avulla saadaan $N$ toisen asteen differentiaaliyhtälöä. Hamiltonin mekaniikalla saman systeemin kehitys kuvataan ensimmäisen asteen differentiaaliyhtälöillä joita on $2N$ kappaletta.

Legendre muuntamalla Lagrangen funktio $L(\mathbf{q}, \mathbf{\dot{q}}, t)$ muuttujien $\dot{q}_i$ suhteen saadaan Hamiltonin funktio
\begin{align}
H(q_i, p_i, t) = \sum_{i=1}^N p_i \dot{q}_i - L(q_i, \dot{q}_i, t)
\end{align}
josta voidaan eliminoida $\dot{q}_i$ yleistetyn liikemäärän
\begin{align} \label{eq:liikemäärä}
p_i = \frac{\partial L}{\partial \dot{q}_i}
\end{align}
avulla. Nyt tarkastelemalla Hamiltonin funktion kokonaisderivaattaa päädytään Hamiltonin yhtälöihin
\begin{align} 
\dot{p}_i =& -\frac{\partial H}{\partial q_i} \label{eq:hamiltoninp} \\
\dot{q}_i =& \: \frac{\partial H}{\partial p_i} \label{eq:hamiltoninq}
\end{align}
jotka ovat systeemin liikeyhtälöt. Nämä yhtälöt ovat ekvivalentteja yhtälöiden \ref{eq:eulerlag} kanssa. \citep{tuominen_2017}

Hamiltonin mekaniikassa kuvataan siis systeemin tila vektoreiden $\mathbf{q}$ ja $\mathbf{p}$ avulla. Voidaan myös miettiä, että systeemin tila on piste paikka ja liikemäärä koordinaattien määrittelemässä $2N$ ulotteisessa avaruudessa. Tätä avaruutta kutsutaan faasiavaruudeksi. \citep{nolte_2015}

Lisäksi jos systeemin kineettinen energia on tavallista muotoa $T = \frac{1}{2} \sum_i m_i \dot{q}_i^2$ ja potentiaalienergia $V = V(\mathbf{q})$, voidaan Hamiltonin funktio kirjoittaa muodossa
\begin{align}
H = T + V
\end{align}
joka on systeemin kokonaisenergia.\citep{arnold_1989}

\section{Symplektisyys}
%?????
%Symplektisyys 101
Suuri etu Lagrangen mekaniikassa verrattuna Newtonin mekaniikkaan on kyky vaihtaa koordinaattisysteemiä vapaammin. Myös Hamiltonin mekaniikassa koordinaattisysteemin vaihtaminen onnistuu, mutta sillä on tiukemmat rajoitukset. 

Ensin helpottaa, jos määritellään Hamiltonin yhtälöt \ref{eq:hamiltoninp} ja \ref{eq:hamiltoninq} uudelleen vektorin $x = (q_1, \,\dots, \,q_n, \,p_1, \,\dots, \,p_n)$ ja $2n \times 2n$ matriisin 
\begin{align}
J = 
\begin{pmatrix}
0 & I \\
-I & 0
\end{pmatrix}
\end{align}
avulla. Matriisin komponentti $I$ on $n \times n$ identiteetti matriisi. Nyt Hamiltonin yhtälöt saavat muodon
\begin{align}
\dot{x} = J \frac{\partial H}{\partial x}
\end{align}




\section{Harmoninen oskillaattori}
%Johda diffikset ja analyyttinen ratkaisu


Harmonisen oskillaattorin Lagrangen funktio on
\begin{align}
L(q, \dot{q}) = \frac{1}{2} m \dot{q}^2 - \frac{1}{2} m \omega^2 q^2
\end{align}
missä $m$ ja $\omega$ ovat vakioita. Liikemäärä voidaan laskea yhtälön \ref{eq:liikemäärä} avulla, jolloin saadaan $p = m\dot{q}$. Sitten liikemäärää käyttämällä voidaan kirjoitaa systeemin Hamiltonin funktio.
\begin{align}
H(q, p) = \frac{p^2}{2m} + \frac{1}{2} m \omega^2 q^2
\end{align}
Hamiltonin funktiosta pystytään nyt ratkaisemaan liikeyhtälöt
\begin{align} \label{eq:harmliike1}
\dot{p} =& -m \omega^2 q \\
\label{eq:harmliike2}
\dot{q} =& \: \frac{p}{m}
\end{align}
joilla voidaan kuvata systeemin kehitys. Vaihtoehtoisesti Lagrangen funktiosta voidaan johtaa suoraan toisen asteen differentiaaliyhtälö
\begin{align} \label{eq:harmtoinen}
\ddot{q} = -\omega^2 q
\end{align}
jonka ratkaisu on yleisesti tunnettu.
\begin{align} \label{eq:harmanal}
q(t) = \:A \, \sin(\omega t + \phi)
\end{align}
missä $A$ ja $\phi$ riippuvat systeemin alkuarvoista.

\chapter{Runge-Kutta} \label{ch:rk}

RK johdantoa

Ensimmäisenä menetelmänä käytetään neljännen asteen Runge-Kutta menetelmää. 


\section{Menetelmän toiminta/johto}

Runge-Kutta menetelmällä voidaan ratkaista ensimmäisen asteen differentiaaliyhtälöitä. Eli yhtälöitä, jotka ovat muotoa
\begin{align} \label{eq:rkalkudiff}
\frac{d y(t)}{dt} = f(t, y)
\end{align}
missä $y(t)$ on funktio, joka yritetään ratkaista ja $f(t, y)$ on mielivaltainen tiedetty funktio. Lisäksi tarvitaan alkuarvo $y(t_0) = y_0$, jotta ratkaiseminen voidaan aloittaa.

Integroimalla yhtälöä \ref{eq:rkalkudiff} puolittain yhden aika-askeleen $h$ matkan verran ja merkitsemällä $y_1 \equiv y(t_0 + h)$ saadaan
\begin{align}
y_1 = y_0 + \int_{t_0}^{t_0 + h} f(t, y) dt
\end{align}
ja tästä voidaan approksimoida puolisuunnikassäännöllä
\begin{align} \label{eq:y1ongelma}
y_1 = y_0 + \frac{h}{2} \: [f(t_0, \: y_0) + f(t_0 + h, \: y_1)]
\end{align}
Nyt huomataan ongelma. Arvo $y_1$, joka halutaan ratkaista, on yhtälössä molemmilla puolilla. Ongelmasta pästään eroon korvaamalla $y_1$ yhtälön oikealla puolella arviolla $y_1 \approx y_0 + h f(t_0, y_0)$.
Sijoitetaan arvio yhtälöön \ref{eq:y1ongelma}, jolloin saadaan 
\begin{align} \label{eq:y1open}
y_1 = y_0 + \frac{h}{2} \: [ f(t_0, \: y_0) + f(t_0 + h, \: y_0 + h f(t_0, y_0)) ]
\end{align}
Nyt voidaan huomata, että $k_1 = f(t_0, y_0)$ ja $k_2 = f(t_0 + h, y_0 + h k_1)$ ovat kulmakertoimia ja kun kirjoitetaan \ref{eq:y1open} uudestaan niiden avulla saadaan
\begin{align}
y_1 = y_0 + \frac{h}{2} k_1 + \frac{h}{2} k_2
\end{align}
Eli seuraavan aika-askeleen arvo saadaan ottamalla edellisen askeleen arvo ja sen jälkeen seuraamalla ensimmäistä kulmakerrointa aika-askeleen puoleenväliin, minkä jälkeen seurataan toista kulmakerrointa askeleen loppuun. Tämän menetelmän ero pelkkään aika-askeleen puolittamiseen tulee siitä, että toisen kulmakertoimen laskemisessa on käytetty avuksi ensimmäistä kulmakerrointa.

% kuva

Kahden kulmakertoimen sijasta menetelmä voidaan yleistää useammalle kulmakertoimelle joilla jokaisella on oma painotuksensa. Eli seuraavan askeleen arvo $n$:llä kulmakertoimella saadaan summalla
\begin{align} \label{eq:rkyleinen}
y_1 = y_0 + h \sum_{i = 1}^n b_i k_i
\end{align}
missä $b_i$ ovat tiedettyjä kertoimia. Kahden kulmakertoimen esimerkissä jälkimmäisen kulmakertoimen laskemisessa käytettiin apuna ensimmäistä. Nyt otetaan huomioon kaikki edeltävät kulmakertoimet, jolloin kulmakertoimet saadaan kaavalla
\begin{align} \label{eq:kulmaki}
k_i = f(t_0 + h c_i\, , \: y_0 + h \sum_{j = 1}^{i-1} a_{i j}\, k_j)
\end{align}
missä $c_i$ ja $a_{ij}$ ovat tiedettyjä kertoimia, jotka yhdessä kaavan \ref{eq:rkyleinen} kertoimien $b_i$ kanssa määrittelevät eri Runge-Kutta menetelmät. 

Näin määritellyt menetelmät ovat eksplisiittisiä. Menetelmä voi olla myös implisiittinen, jolloin kulmakertoimet voivat riippua kaikista aika-askeleen muista kulmakertoimista, eivät vain edeltävistä. Molemmassa tapauksessa kertoimet esitetään yleensä kuten taulukossa \ref{ta:butcheresim}. Eksplisiittisessä tapauksessa kertoimet $a_{ij}$, joissa $i \leq j$ ovat nollia ja monesti jätetään siksi taulukossa tyhjiksi. 

\begin{table}[!h]
	\centering
	\caption{Butcher taulukko Runge-Kutta menetelmien kertoimille}
	\begin{tabular}{c | c c c c} 
		$c_1$	& $a_{11}$ & $a_{12}$ & $\dots$ & $a_{1n}$ \\
		$c_2$	& $a_{21}$ & $a_{22}$ & $\dots$ & $a_{2n}$ \\
		$\vdots$& $\vdots$ & $\vdots$ & 	 	 & $\vdots$ \\
		$c_n$	& $a_{n1}$ & $a_{n2}$ & $\dots$ & $a_{nn}$ \\ \hline
		 		& $b_1$	   & $b_2$    & $\dots$ & $b_n$    \\
	\end{tabular}
	\label{ta:butcheresim}
\end{table}

% kertoimien rajoitukset

\citep{hairer_2006}
\cite{hairer_2006}


\section{Toteutus}

Vertailussa käytetään neljännen asteen Runge-Kutta menetelmää, joka tunnetaan nimellä Runge-Kutta menetelmä\footnote[2]{engl. The Runge-Kutta method tai classic Runge-Kutta method}. Wilhelm Kutta esitteli menetelmän 1901, minkä jälkeen se on ollut laajassa käytössä. Taulukossa \ref{ta:rk4butcher} on menetelmän kertoimet. \citep{hairer_1993}

\begin{table}[!h]
	\centering
	\caption{Butcher taulukko Runge-Kutta menetelmän kertoimille}	
	\begin{tabular}{c | c c c c} 
		$0$		&  		&  		&  		&  		\\
		$1/2$	& $1/2$ &  		&  		&  		\\
		$1/2$ 	& $0$ 	& $1/2$ & 	 	&  		\\
		$1$ 	& $0$ 	& $0$ 	& $1$ 	&  		\\ \hline
		 		& $1/6$	& $2/6$ & $2/6$ & $1/6$ \\
	\end{tabular}
	\label{ta:rk4butcher}
\end{table}

Systeemi, joka halutaan ratkaista koostuu nyt yhtälöistä \ref{eq:harmliike1} ja \ref{eq:harmliike2}. Eli yhtälöt eivät ole muotoa $\dot{y} = f(t, y)$, jolle menetelmä johdettiin. Sen sijaan systeemissä on kaksi yhtälöä, jotka riippuvat toisistaan. 
\begin{align}
\dot{p} = f(q) \\
\dot{q} = g(p)
\end{align}
Menetelmää voidaan silti käyttää. Ensin lasketaan ensimmäiset kulmakertoimet.
\begin{align}
k_{p,1} = \: f(q_0) = -l q_0 \:,\quad k_{q,1} = \: g(p_0) = \frac{1}{m} p_0
\end{align}
Toisia kulmakertoimia laskiessa käytetään ensimmäisessä vaiheessa saatuja kulmakermia niin kuin yhtälössä \ref{eq:kulmaki} määritelläänkin. Nyt vain täytyy käyttää sitä kulmakerrointa, josta funktio riippuu. Eli liikemäärän kulmakertoimia laskiessa käytetään paikan kulmakertoimia ja päinvastoin. Näin saadaan loput kolme paria kulmakertoimia.
\begin{align}
k_{p,2} = \: -l(q_0 + \frac{h}{2} k_{q,1}) \:,&\quad k_{q,2} = \: \frac{1}{m}(p_0 + \frac{h}{2} k_{p,1}) \\
k_{p,3} = \: -l(q_0 + \frac{h}{2} k_{q,2}) \:,&\quad k_{q,3} = \: \frac{1}{m}(p_0 + \frac{h}{2} k_{p,2}) \\
k_{p,4} = \: -l(q_0 + h k_{q,3}) \:,&\quad k_{q,4} = \: \frac{1}{m}(p_0 + h k_{p,3})
\end{align}
Sitten voidaan laskea seuraavan askeleen arvo käyttäen saatuja kulmakertoimia.
\begin{align}
p_1 = p_0 + \frac{h}{6}( k_{p,1} + 2 k_{p,2} + 2 k_{p,3} + k_{p,4}) \\
q_1 = q_0 + \frac{h}{6}( k_{q,1} + 2 k_{q,2} + 2 k_{q,3} + k_{q,4}) 
\end{align}
Vertailua varten tehtiin Python koodi, joka käyttää yllä mainittua menetelmää. Koodi on liitteessä \ref{ap:rk4}.

% kirjoita laskennan välivaiheet
% koodi liitteenä

\chapter{Loikkakeino} \label{ch:lf}

Loikkakeino johdantoa

\section{Johto}

Loikkakeinon johto.

- rajoitukset

- symplektisyys


\section{Toteutus}

Menetelmän toteutus.





\chapter{Vertailu}
%%%
%Vertaillaan Runge-Kuttaa, loikkakeinoa ja analyyttistä ratkaisua.
%- Virheen arviointi menetelmä
%- Alkuarvot + vakiot
%- Vertailu lyhyellä ajanjaksolla
%- Vertailu pitkällä ajanjaksolla
%- Aika-askeleen pituuden vaikutus
%- Menetelmien laskennallisen raskauden vertailu lyhyesti
%%%
 

Aiemmin luvuissa \ref{ch:rk} ja \ref{ch:lf} käytiin läpi loikkakeino -ja Runge-Kutta menetelmien toimintaperiaatteet ja toteutukset. Nyt menetelmät laitetaan käytäntöön ja niillä saatuja tuloksia vertaillaan.

Jotta menetelmiä voitaisiin käyttää, täytyy vielä tietää systeemin alkuarvot ja vakioiden suuruudet. Koska tarkoituksena on vain vertailla menetelmiä, voidaan alkuarvoiksi valita
\begin{align}
p_0 = 1.0 \:,& \quad q_0 = 0.0
\end{align}
Kun valitaan vielä vakioiksi $\omega = 1$ ja $m = 1$ saadaan analyyttiselle ratkaisulle \ref{eq:harmanal} arvot
\begin{align}
A = 1.0 \:,& \quad \phi = 0.0
\end{align}
Näiden valintojen vuoksi saaduilla tuloksilla ei ole yksiköitä ja analyyttinen ratkaisu on käyrä, joka seuraa yksikköympyrää. 



\begin{figure}[!h]
	\label{fi:ps_kuvat}
	\centering
	\includegraphics[width=\textwidth]{phase_space.png}
	\caption{Harmonisen oskillaattorin ensimmäinen värähdys kuvattuna faasiavaruudessa. Numeerisilla menetelmillä laskettiin seitsemän ensimmäistä askelta aika-askeleella $0.9$.}
\end{figure}

asiaa




\chapter{Päätelmät}

Mitä johtopäätöksiä voidaan tehdä tuloksista ja vertailusta.


\appendix
\chapter*{Liitteet}
\addcontentsline{toc}{chapter}{Liitteet}
\renewcommand{\thesection}{\Alph{section}}

\section{Runge-Kutta menetelmän koodi} \label{ap:rk4}

koodia

\section{Loikkakeino menetelmän koodi} \label{ap:lf}

lisää koodia

% STEP 5:
% Uncomment the following lines and set your .bib file and desired bibliography style
% to make a bibliography with BibTeX.
% Alternatively you can use the thebibliography environment if you want to add all
% references by hand.

\cleardoublepage %fixes the position of bibliography in bookmarks
\phantomsection

\addcontentsline{toc}{chapter}{\bibname} % This lines adds the bibliography to the ToC
%\bibliographystyle{unsrt} % numbering 
\bibliographystyle{apalike} % name, year
\bibliography{bibliography.bib}

\end{document}
